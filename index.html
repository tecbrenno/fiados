<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Fiado - Mercadinho</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 1024px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin: -20px -20px 20px -20px;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: white;
            border: none;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            color: #666;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab:hover:not(.active) {
            background: #f8f8f8;
        }

        .content {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 500px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-success {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336 0%, #da190b 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
        }

        .card {
            background: #f8f8f8;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
            transition: all 0.3s;
        }

        .card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .client-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .client-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }

        .client-item:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .client-info h3 {
            margin: 0 0 5px 0;
            color: #333;
        }

        .client-info p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }

        .debt-amount {
            font-size: 24px;
            font-weight: bold;
            color: #f44336;
        }

        .calculator {
            background: #f8f8f8;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .calc-display {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: right;
            font-size: 24px;
            font-weight: bold;
            border: 2px solid #e0e0e0;
            min-height: 50px;
        }

        .calc-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .calc-btn {
            padding: 20px;
            font-size: 20px;
            background: #2c3e50;
            color: white;
            border: 2px solid #34495e;
            font-weight: bold;
        }

        .calc-btn:hover {
            background: #34495e;
            transform: scale(1.02);
        }

        .calc-btn.operator {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: none;
        }

        .calc-btn.operator:hover {
            background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
        }

        .item-list {
            margin-top: 20px;
        }

        .item-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f8f8;
            border-radius: 8px;
        }

        .item-row input {
            flex: 1;
        }

        .summary-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }

        .summary-box h2 {
            margin-bottom: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background: white;
            max-width: 600px;
            margin: 50px auto;
            padding: 30px;
            border-radius: 15px;
            position: relative;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 30px;
            cursor: pointer;
            color: #999;
        }

        .close-modal:hover {
            color: #333;
        }

        .transaction-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .transaction-item {
            padding: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stat-card h3 {
            font-size: 14px;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .stat-card p {
            font-size: 28px;
            font-weight: bold;
        }

        .autocomplete-container {
            position: relative;
        }

        .autocomplete-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e0e0e0;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: none;
        }

        .autocomplete-suggestions.active {
            display: block;
        }

        .suggestion-item {
            padding: 12px;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid #f0f0f0;
        }

        .suggestion-item:hover {
            background: #f8f8f8;
        }

        .suggestion-item.selected {
            background: #e8f0fe;
        }

        .suggestion-category {
            font-size: 12px;
            color: #666;
            margin-left: 10px;
        }

        .selected-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
        }

        .selected-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .selected-item button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0;
            margin: 0;
            font-size: 16px;
            line-height: 1;
        }
            .container {
                padding: 10px;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1 1 50%;
            }
            
            .calc-buttons {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .success-message {
            background: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .add-new-product {
            padding: 12px;
            background: #e8f0fe;
            cursor: pointer;
            border-bottom: 2px solid #667eea;
            font-weight: bold;
            color: #667eea;
        }

        .add-new-product:hover {
            background: #d2e3fc;
        }
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }
    </style>
</head>
<body>
<div id="loginContainer" style="position: fixed; inset: 0; background: #f5f5f5; display: flex; justify-content: center; align-items: center; z-index: 9999;">
    <div style="background: white; padding: 40px; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.1); max-width: 300px; width: 100%; text-align: center;">
        <h2 style="margin-bottom: 20px;">Acesso Restrito</h2>
        <input id="username" type="text" placeholder="Usu√°rio" style="width: 100%; padding: 10px; margin-bottom: 10px;">
        <div style="position: relative; width: 100%;">
            <input id="password" type="password" placeholder="Senha" style="width: 100%; padding: 10px; margin-bottom: 10px;">
            <span onclick="togglePasswordVisibility()" style="position: absolute; right: 10px; top: 12px; cursor: pointer;">üëÅÔ∏è</span>
        </div>
        <button onclick="login()" style="padding: 10px 20px;">Entrar</button>
        <p id="loginError" style="color: red; margin-top: 10px; display: none;">Usu√°rio ou senha incorretos</p>
    </div>
</div>

<!-- Bot√£o de logout -->
<div id="logoutButtonContainer" style="position: fixed; top: 15px; right: 15px; z-index: 9998; display: none;">
    <button onclick="logout()" style="padding: 10px 20px; background: #f44336; color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer;">
        Sair
    </button>
</div>


    <div class="container">
        <div class="header">
            <h1>Sistema de Fiado</h1>
            <p>Controle simples e r√°pido para seu mercadinho</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showSection('vendas')">Nova Venda</button>
            <button class="tab" onclick="showSection('clientes')">Clientes</button>
            <button class="tab" onclick="showSection('consultar')">Consultar D√©bitos</button>
            <button class="tab" onclick="showSection('relatorios')">Relat√≥rios</button>
        </div>

        <div class="content">
            <!-- Se√ß√£o de Vendas -->
            <div id="vendas" class="section active">
                <h2>Nova Venda Fiado</h2>
                
                <div class="form-group">
                    <label>Cliente:</label>
                    <select id="clienteVenda" onchange="verificarClienteAutorizado()">
                        <option value="">Selecione um cliente...</option>
                    </select>
                </div>

                <div id="clienteNaoAutorizado" style="display: none;" class="card" style="background: #fff3cd; border-color: #ffeeba;">
                    <p style="color: #856404;">‚ö†Ô∏è Este cliente n√£o est√° autorizado para compras fiado.</p>
                </div>

                <div id="areaVenda" style="display: none;">
                    <div class="calculator">
                        <div class="calc-display" id="calcDisplay">0</div>
                        <div class="calc-buttons">
                            <button class="calc-btn" onclick="addNumber('7')">7</button>
                            <button class="calc-btn" onclick="addNumber('8')">8</button>
                            <button class="calc-btn" onclick="addNumber('9')">9</button>
                            <button class="calc-btn operator" onclick="setOperator('/')">√∑</button>
                            
                            <button class="calc-btn" onclick="addNumber('4')">4</button>
                            <button class="calc-btn" onclick="addNumber('5')">5</button>
                            <button class="calc-btn" onclick="addNumber('6')">6</button>
                            <button class="calc-btn operator" onclick="setOperator('*')">√ó</button>
                            
                            <button class="calc-btn" onclick="addNumber('1')">1</button>
                            <button class="calc-btn" onclick="addNumber('2')">2</button>
                            <button class="calc-btn" onclick="addNumber('3')">3</button>
                            <button class="calc-btn operator" onclick="setOperator('-')">-</button>
                            
                            <button class="calc-btn" onclick="addNumber('0')">0</button>
                            <button class="calc-btn" onclick="addDecimal()">.</button>
                            <button class="calc-btn operator" onclick="calculate()">=</button>
                            <button class="calc-btn operator" onclick="setOperator('+')">+</button>
                        </div>
                        <div style="margin-top: 10px; display: flex; gap: 10px;">
                            <button class="btn-secondary" style="flex: 1" onclick="clearCalc()">Limpar</button>
                            <button class="btn-success" style="flex: 1" onclick="adicionarItem()">Adicionar Item</button>
                        </div>
                    </div>

                    <div class="item-list">
                        <h3>Itens da Compra</h3>
                        <div id="itensCompra"></div>
                        
                        <div class="summary-box">
                            <h2>Total: R$ <span id="totalCompra">0,00</span></h2>
                        </div>

                        <div style="margin-top: 20px;">
                            <label>Observa√ß√µes (opcional):</label>
                            <div id="selectedItems" class="selected-items"></div>
                            <div class="autocomplete-container">
                                <textarea id="obsCompra" rows="3" placeholder="Digite para buscar produtos ou escreva livremente..."></textarea>
                                <div id="autocompleteSuggestions" class="autocomplete-suggestions"></div>
                            </div>
                        </div>

                        <div style="margin-top: 20px; display: flex; gap: 10px;">
                            <button class="btn-danger" onclick="cancelarVenda()">Cancelar</button>
                            <button class="btn-success" onclick="finalizarVenda()" style="flex: 1;">Finalizar Venda</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o de Clientes -->
            <div id="clientes" class="section">
                <h2>Gerenciar Clientes</h2>
                
                <button onclick="mostrarFormCliente()" style="margin-bottom: 20px;">+ Novo Cliente</button>

                <div id="formCliente" style="display: none;" class="card">
                    <h3>Cadastrar Cliente</h3>
                    <div class="form-group">
                        <label>Nome:</label>
                        <input type="text" id="nomeCliente" placeholder="Nome completo">
                    </div>
                    <div class="form-group">
                        <label>Telefone:</label>
                        <input type="tel" id="telefoneCliente" placeholder="(00) 00000-0000">
                    </div>
                    <div class="form-group">
                        <label>Dia de Pagamento:</label>
                        <input type="number" id="diaPagamento" min="1" max="31" placeholder="Ex: 5, 10, 15...">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="clienteAutorizado" checked>
                            Cliente autorizado para compras fiado
                        </label>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn-secondary" onclick="cancelarFormCliente()">Cancelar</button>
                        <button onclick="salvarCliente()">Salvar Cliente</button>
                    </div>
                </div>

                <div class="client-list" id="listaClientes"></div>
            </div>

            <!-- Se√ß√£o de Consulta de D√©bitos -->
            <div id="consultar" class="section">
                <h2>Consultar e Gerenciar D√©bitos</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total em Aberto</h3>
                        <p>R$ <span id="totalAberto">0,00</span></p>
                    </div>
                    <div class="stat-card">
                        <h3>Clientes Devedores</h3>
                        <p id="totalDevedores">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Vencidos Hoje</h3>
                        <p>R$ <span id="vencidosHoje">0,00</span></p>
                    </div>
                </div>

                <div class="form-group">
                    <input type="text" id="buscarDebito" placeholder="Buscar cliente..." onkeyup="filtrarDebitos()">
                </div>

                <div id="listaDebitos"></div>
            </div>

            <!-- Se√ß√£o de Relat√≥rios -->
            <div id="relatorios" class="section">
                <h2>Relat√≥rios</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Vendas Hoje</h3>
                        <p>R$ <span id="vendasHoje">0,00</span></p>
                    </div>
                    <div class="stat-card">
                        <h3>Vendas M√™s</h3>
                        <p>R$ <span id="vendasMes">0,00</span></p>
                    </div>
                    <div class="stat-card">
                        <h3>Recebido Hoje</h3>
                        <p>R$ <span id="recebidoHoje">0,00</span></p>
                    </div>
                </div>

                <div class="card">
                    <h3>Hist√≥rico de Transa√ß√µes</h3>
                    <div class="transaction-list" id="historicoTransacoes"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Detalhes do Cliente -->
    <div id="modalCliente" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="fecharModal()">&times;</span>
            <h2 id="modalClienteNome"></h2>
            <div id="modalClienteConteudo"></div>
        </div>
    </div>

    <script>
        // Estado da aplica√ß√£o
        let clientes = JSON.parse(localStorage.getItem('clientes') || '[]');
        let vendas = JSON.parse(localStorage.getItem('vendas') || '[]');
        let pagamentos = JSON.parse(localStorage.getItem('pagamentos') || '[]');
        
        // Estado da calculadora
        let calcDisplay = '0';
        let calcOperator = null;
        let calcWaitingForOperand = false;
        let calcValue = null;
        
        // Estado da venda atual
        let itensVenda = [];
        let selectedProducts = [];
        
        // Lista de produtos para autocomplete
        let produtos = JSON.parse(localStorage.getItem('produtos') || JSON.stringify([
            // Alimentos b√°sicos
            { nome: 'Arroz', categoria: 'Alimentos' },
            { nome: 'Arroz integral', categoria: 'Alimentos' },
            { nome: 'Feij√£o preto', categoria: 'Alimentos' },
            { nome: 'Feij√£o carioca', categoria: 'Alimentos' },
            { nome: 'Feij√£o branco', categoria: 'Alimentos' },
            { nome: 'A√ß√∫car cristal', categoria: 'Alimentos' },
            { nome: 'A√ß√∫car refinado', categoria: 'Alimentos' },
            { nome: 'Sal', categoria: 'Alimentos' },
            { nome: 'Farinha de trigo', categoria: 'Alimentos' },
            { nome: 'Farinha de mandioca', categoria: 'Alimentos' },
            { nome: 'Fub√°', categoria: 'Alimentos' },
            { nome: 'Macarr√£o', categoria: 'Alimentos' },
            { nome: 'Macarr√£o instant√¢neo', categoria: 'Alimentos' },
            { nome: '√ìleo de soja', categoria: 'Alimentos' },
            { nome: 'Azeite', categoria: 'Alimentos' },
            { nome: 'Vinagre', categoria: 'Alimentos' },
            { nome: 'Caf√©', categoria: 'Alimentos' },
            { nome: 'Leite em p√≥', categoria: 'Alimentos' },
            { nome: 'Achocolatado', categoria: 'Alimentos' },
            { nome: 'Biscoito cream cracker', categoria: 'Alimentos' },
            { nome: 'Biscoito recheado', categoria: 'Alimentos' },
            { nome: 'P√£o de forma', categoria: 'Alimentos' },
            { nome: 'P√£o franc√™s', categoria: 'Alimentos' },
            
            // Enlatados e conservas
            { nome: 'Sardinha', categoria: 'Enlatados' },
            { nome: 'Atum', categoria: 'Enlatados' },
            { nome: 'Milho verde', categoria: 'Enlatados' },
            { nome: 'Ervilha', categoria: 'Enlatados' },
            { nome: 'Molho de tomate', categoria: 'Enlatados' },
            { nome: 'Extrato de tomate', categoria: 'Enlatados' },
            { nome: 'Leite condensado', categoria: 'Enlatados' },
            { nome: 'Creme de leite', categoria: 'Enlatados' },
            
            // Bebidas
            { nome: 'Coca-Cola', categoria: 'Bebidas' },
            { nome: 'Guaran√°', categoria: 'Bebidas' },
            { nome: 'Fanta', categoria: 'Bebidas' },
            { nome: 'Sprite', categoria: 'Bebidas' },
            { nome: '√Ågua mineral', categoria: 'Bebidas' },
            { nome: 'Suco de laranja', categoria: 'Bebidas' },
            { nome: 'Suco de uva', categoria: 'Bebidas' },
            { nome: 'Cerveja Skol', categoria: 'Bebidas' },
            { nome: 'Cerveja Brahma', categoria: 'Bebidas' },
            { nome: 'Cerveja Antarctica', categoria: 'Bebidas' },
            { nome: 'Cerveja Heineken', categoria: 'Bebidas' },
            { nome: 'Vinho', categoria: 'Bebidas' },
            { nome: 'Cacha√ßa', categoria: 'Bebidas' },
            { nome: 'Vodka', categoria: 'Bebidas' },
            { nome: 'Whisky', categoria: 'Bebidas' },
            
            // Frios e latic√≠nios
            { nome: 'Queijo mussarela', categoria: 'Frios' },
            { nome: 'Queijo prato', categoria: 'Frios' },
            { nome: 'Presunto', categoria: 'Frios' },
            { nome: 'Mortadela', categoria: 'Frios' },
            { nome: 'Salame', categoria: 'Frios' },
            { nome: 'Iogurte', categoria: 'Frios' },
            { nome: 'Requeij√£o', categoria: 'Frios' },
            { nome: 'Manteiga', categoria: 'Frios' },
            { nome: 'Margarina', categoria: 'Frios' },
            { nome: 'Leite', categoria: 'Frios' },
            
            // Carnes
            { nome: 'Carne mo√≠da', categoria: 'Carnes' },
            { nome: 'Frango', categoria: 'Carnes' },
            { nome: 'Lingui√ßa', categoria: 'Carnes' },
            { nome: 'Salsicha', categoria: 'Carnes' },
            { nome: 'Bacon', categoria: 'Carnes' },
            { nome: 'Peixe', categoria: 'Carnes' },
            { nome: 'Carne de porco', categoria: 'Carnes' },
            { nome: 'Ovos', categoria: 'Carnes' },
            
            // Higiene pessoal
            { nome: 'Sabonete', categoria: 'Higiene' },
            { nome: 'Shampoo', categoria: 'Higiene' },
            { nome: 'Condicionador', categoria: 'Higiene' },
            { nome: 'Pasta de dente', categoria: 'Higiene' },
            { nome: 'Escova de dente', categoria: 'Higiene' },
            { nome: 'Papel higi√™nico', categoria: 'Higiene' },
            { nome: 'Desodorante', categoria: 'Higiene' },
            { nome: 'Absorvente', categoria: 'Higiene' },
            { nome: 'Barbeador', categoria: 'Higiene' },
            { nome: 'Creme de barbear', categoria: 'Higiene' },
            
            // Limpeza
            { nome: 'Detergente', categoria: 'Limpeza' },
            { nome: 'Sab√£o em p√≥', categoria: 'Limpeza' },
            { nome: 'Sab√£o em barra', categoria: 'Limpeza' },
            { nome: 'Amaciante', categoria: 'Limpeza' },
            { nome: '√Ågua sanit√°ria', categoria: 'Limpeza' },
            { nome: 'Desinfetante', categoria: 'Limpeza' },
            { nome: 'Esponja', categoria: 'Limpeza' },
            { nome: 'Palha de a√ßo', categoria: 'Limpeza' },
            { nome: 'Saco de lixo', categoria: 'Limpeza' },
            { nome: '√Ålcool', categoria: 'Limpeza' },
            
            // Outros
            { nome: 'Cigarro', categoria: 'Outros' },
            { nome: 'Isqueiro', categoria: 'Outros' },
            { nome: 'F√≥sforo', categoria: 'Outros' },
            { nome: 'Pilha', categoria: 'Outros' },
            { nome: 'Vela', categoria: 'Outros' },
            { nome: 'Lampada', categoria: 'Outros' },
            { nome: 'G√°s de cozinha', categoria: 'Outros' },
            { nome: 'Carv√£o', categoria: 'Outros' },
            
            // Verduras e legumes
            { nome: 'Tomate', categoria: 'Hortifruti' },
            { nome: 'Cebola', categoria: 'Hortifruti' },
            { nome: 'Alho', categoria: 'Hortifruti' },
            { nome: 'Batata', categoria: 'Hortifruti' },
            { nome: 'Cenoura', categoria: 'Hortifruti' },
            { nome: 'Alface', categoria: 'Hortifruti' },
            { nome: 'Couve', categoria: 'Hortifruti' },
            { nome: 'Cheiro verde', categoria: 'Hortifruti' },
            
            // Frutas
            { nome: 'Banana', categoria: 'Frutas' },
            { nome: 'Ma√ß√£', categoria: 'Frutas' },
            { nome: 'Laranja', categoria: 'Frutas' },
            { nome: 'Lim√£o', categoria: 'Frutas' },
            { nome: 'Mam√£o', categoria: 'Frutas' },
            { nome: 'Melancia', categoria: 'Frutas' },
            { nome: 'Abacaxi', categoria: 'Frutas' },
            
            // Guloseimas
            { nome: 'Chocolate', categoria: 'Guloseimas' },
            { nome: 'Bombom', categoria: 'Guloseimas' },
            { nome: 'Bala', categoria: 'Guloseimas' },
            { nome: 'Chiclete', categoria: 'Guloseimas' },
            { nome: 'Pipoca', categoria: 'Guloseimas' },
            { nome: 'Salgadinho', categoria: 'Guloseimas' },
            { nome: 'Sorvete', categoria: 'Guloseimas' },
            { nome: 'Picol√©', categoria: 'Guloseimas' }
        ]));

        // Inicializa√ß√£o
        window.onload = function() {
            carregarDados();
            atualizarListaClientes();
            atualizarSelectClientes();
            atualizarDebitos();
            atualizarRelatorios();
            setupAutocomplete();
        };

        // Navega√ß√£o entre se√ß√µes
        function showSection(sectionId) {
            // Esconder todas as se√ß√µes
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            
            // Mostrar se√ß√£o selecionada
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
            
            // Atualizar dados ao mudar de aba
            if (sectionId === 'consultar') {
                atualizarDebitos();
            } else if (sectionId === 'relatorios') {
                atualizarRelatorios();
            }
        }

        // Fun√ß√µes de Persist√™ncia
        function salvarDados() {
            localStorage.setItem('clientes', JSON.stringify(clientes));
            localStorage.setItem('vendas', JSON.stringify(vendas));
            localStorage.setItem('pagamentos', JSON.stringify(pagamentos));
            localStorage.setItem('produtos', JSON.stringify(produtos));
        }

        function carregarDados() {
            clientes = JSON.parse(localStorage.getItem('clientes') || '[]');
            vendas = JSON.parse(localStorage.getItem('vendas') || '[]');
            pagamentos = JSON.parse(localStorage.getItem('pagamentos') || '[]');
            
            // Carregar produtos salvos ou usar os padr√µes
            const produtosSalvos = localStorage.getItem('produtos');
            if (produtosSalvos) {
                produtos = JSON.parse(produtosSalvos);
            }
        }

        // Fun√ß√µes da Calculadora
        function updateDisplay() {
            document.getElementById('calcDisplay').textContent = calcDisplay;
        }

        function addNumber(num) {
            if (calcWaitingForOperand) {
                calcDisplay = num;
                calcWaitingForOperand = false;
            } else {
                calcDisplay = calcDisplay === '0' ? num : calcDisplay + num;
            }
            updateDisplay();
        }

        function addDecimal() {
            if (calcWaitingForOperand) {
                calcDisplay = '0.';
                calcWaitingForOperand = false;
            } else if (!calcDisplay.includes('.')) {
                calcDisplay += '.';
            }
            updateDisplay();
        }

        function setOperator(nextOperator) {
            const inputValue = parseFloat(calcDisplay);

            if (calcValue === null) {
                calcValue = inputValue;
            } else if (calcOperator) {
                const currentValue = calcValue || 0;
                const newValue = calculate();
                calcDisplay = `${parseFloat(newValue.toFixed(2))}`;
                calcValue = newValue;
            }

            calcWaitingForOperand = true;
            calcOperator = nextOperator;
            updateDisplay();
        }

        function calculate() {
            const inputValue = parseFloat(calcDisplay);

            if (calcValue === null || calcOperator === null) {
                return inputValue;
            }

            let result;
            if (calcOperator === '+') {
                result = calcValue + inputValue;
            } else if (calcOperator === '-') {
                result = calcValue - inputValue;
            } else if (calcOperator === '*') {
                result = calcValue * inputValue;
            } else if (calcOperator === '/') {
                result = calcValue / inputValue;
            }

            calcDisplay = `${parseFloat(result.toFixed(2))}`;
            calcValue = null;
            calcOperator = null;
            calcWaitingForOperand = true;
            updateDisplay();
            
            return result;
        }

        function clearCalc() {
            calcDisplay = '0';
            calcOperator = null;
            calcWaitingForOperand = false;
            calcValue = null;
            updateDisplay();
        }

        // Fun√ß√µes de Venda
        function verificarClienteAutorizado() {
            const clienteId = document.getElementById('clienteVenda').value;
            const cliente = clientes.find(c => c.id === clienteId);
            
            if (!cliente) {
                document.getElementById('areaVenda').style.display = 'none';
                document.getElementById('clienteNaoAutorizado').style.display = 'none';
                return;
            }
            
            if (cliente.autorizado) {
                document.getElementById('areaVenda').style.display = 'block';
                document.getElementById('clienteNaoAutorizado').style.display = 'none';
            } else {
                document.getElementById('areaVenda').style.display = 'none';
                document.getElementById('clienteNaoAutorizado').style.display = 'block';
            }
        }

        function adicionarItem() {
            const valor = parseFloat(calcDisplay);
            if (valor > 0) {
                itensVenda.push({
                    valor: valor,
                    descricao: ''
                });
                atualizarListaItens();
                clearCalc();
            }
        }

        function atualizarListaItens() {
            const container = document.getElementById('itensCompra');
            container.innerHTML = '';
            
            let total = 0;
            
            itensVenda.forEach((item, index) => {
                total += item.valor;
                
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item-row';
                itemDiv.innerHTML = `
                    <input type="text" placeholder="Descri√ß√£o do item..." 
                           value="${item.descricao}" 
                           onchange="itensVenda[${index}].descricao = this.value">
                    <span style="min-width: 100px; text-align: right;">R$ ${item.valor.toFixed(2).replace('.', ',')}</span>
                    <button class="btn-danger" onclick="removerItem(${index})">√ó</button>
                `;
                container.appendChild(itemDiv);
            });
            
            document.getElementById('totalCompra').textContent = total.toFixed(2).replace('.', ',');
        }

        function removerItem(index) {
            itensVenda.splice(index, 1);
            atualizarListaItens();
        }

        function cancelarVenda() {
            if (confirm('Deseja cancelar esta venda?')) {
                itensVenda = [];
                selectedProducts = [];
                document.getElementById('clienteVenda').value = '';
                document.getElementById('obsCompra').value = '';
                document.getElementById('selectedItems').innerHTML = '';
                document.getElementById('areaVenda').style.display = 'none';
                clearCalc();
                atualizarListaItens();
            }
        }

        function finalizarVenda() {
            const clienteId = document.getElementById('clienteVenda').value;
            const obsInput = document.getElementById('obsCompra').value;
            
            // Combinar produtos selecionados com o texto livre
            const produtosSelecionados = selectedProducts.join(', ');
            const obs = produtosSelecionados ? 
                (obsInput ? `${produtosSelecionados}, ${obsInput}` : produtosSelecionados) : 
                obsInput;
            
            if (!clienteId) {
                alert('Selecione um cliente!');
                return;
            }
            
            if (itensVenda.length === 0) {
                alert('Adicione pelo menos um item!');
                return;
            }
            
            const cliente = clientes.find(c => c.id === clienteId);
            const total = itensVenda.reduce((sum, item) => sum + item.valor, 0);
            
            const venda = {
                id: Date.now().toString(),
                clienteId: clienteId,
                clienteNome: cliente.nome,
                data: new Date().toISOString(),
                itens: itensVenda,
                total: total,
                observacoes: obs,
                status: 'pendente',
                dataPagamento: calcularDataPagamento(cliente.diaPagamento)
            };
            
            vendas.push(venda);
            salvarDados();
            
            // Mostrar mensagem de sucesso
            const successMsg = document.createElement('div');
            successMsg.className = 'success-message';
            successMsg.textContent = 'Venda registrada com sucesso!';
            document.querySelector('.content').insertBefore(successMsg, document.querySelector('.content').firstChild);
            
            setTimeout(() => successMsg.remove(), 3000);
            
            // Limpar formul√°rio
            cancelarVenda();
            atualizarDebitos();
            atualizarRelatorios();
        }

        function calcularDataPagamento(diaPagamento) {
            const hoje = new Date();
            let dataPagamento = new Date(hoje.getFullYear(), hoje.getMonth(), diaPagamento);
            
            // Se o dia j√° passou este m√™s, ir para o pr√≥ximo m√™s
            if (dataPagamento <= hoje) {
                dataPagamento.setMonth(dataPagamento.getMonth() + 1);
            }
            
            return dataPagamento.toISOString();
        }

        // Fun√ß√µes de Cliente
        function mostrarFormCliente() {
            document.getElementById('formCliente').style.display = 'block';
        }

        function cancelarFormCliente() {
            document.getElementById('formCliente').style.display = 'none';
            document.getElementById('nomeCliente').value = '';
            document.getElementById('telefoneCliente').value = '';
            document.getElementById('diaPagamento').value = '';
            document.getElementById('clienteAutorizado').checked = true;
        }

        function salvarCliente() {
            const nome = document.getElementById('nomeCliente').value.trim();
            const telefone = document.getElementById('telefoneCliente').value.trim();
            const diaPagamento = parseInt(document.getElementById('diaPagamento').value);
            const autorizado = document.getElementById('clienteAutorizado').checked;
            
            if (!nome || !telefone || !diaPagamento) {
                alert('Preencha todos os campos!');
                return;
            }
            
            if (diaPagamento < 1 || diaPagamento > 31) {
                alert('Dia de pagamento deve ser entre 1 e 31!');
                return;
            }
            
            const cliente = {
                id: Date.now().toString(),
                nome: nome,
                telefone: telefone,
                diaPagamento: diaPagamento,
                autorizado: autorizado,
                dataCadastro: new Date().toISOString()
            };
            
            clientes.push(cliente);
            salvarDados();
            
            cancelarFormCliente();
            atualizarListaClientes();
            atualizarSelectClientes();
            
            // Mostrar mensagem de sucesso
            const successMsg = document.createElement('div');
            successMsg.className = 'success-message';
            successMsg.textContent = 'Cliente cadastrado com sucesso!';
            document.querySelector('#clientes').insertBefore(successMsg, document.querySelector('#clientes').firstChild.nextSibling);
            
            setTimeout(() => successMsg.remove(), 3000);
        }

        function atualizarListaClientes() {
            const container = document.getElementById('listaClientes');
            container.innerHTML = '';
            
            if (clientes.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>Nenhum cliente cadastrado ainda.</p></div>';
                return;
            }
            
            clientes.forEach(cliente => {
                const debito = calcularDebitoCliente(cliente.id);
                const clienteDiv = document.createElement('div');
                clienteDiv.className = 'client-item';
                clienteDiv.innerHTML = `
                    <div class="client-info">
                        <h3>${cliente.nome}</h3>
                        <p>üì± ${cliente.telefone} | üìÖ Dia ${cliente.diaPagamento}</p>
                        <p>${cliente.autorizado ? '‚úÖ Autorizado' : '‚ùå N√£o autorizado'}</p>
                    </div>
                    <div style="text-align: right;">
                        <p class="debt-amount">R$ ${debito.toFixed(2).replace('.', ',')}</p>
                        <button onclick="verDetalhesCliente('${cliente.id}')" style="margin-top: 10px;">Ver Detalhes</button>
                    </div>
                `;
                container.appendChild(clienteDiv);
            });
        }

        function atualizarSelectClientes() {
            const select = document.getElementById('clienteVenda');
            select.innerHTML = '<option value="">Selecione um cliente...</option>';
            
            clientes.forEach(cliente => {
                const option = document.createElement('option');
                option.value = cliente.id;
                option.textContent = cliente.nome;
                select.appendChild(option);
            });
        }

        function calcularDebitoCliente(clienteId) {
            return vendas
                .filter(v => v.clienteId === clienteId && v.status === 'pendente')
                .reduce((total, venda) => total + venda.total, 0);
        }

        // Fun√ß√µes de D√©bitos
        function atualizarDebitos() {
            const container = document.getElementById('listaDebitos');
            container.innerHTML = '';
            
            let totalGeral = 0;
            let totalDevedores = 0;
            let totalVencidoHoje = 0;
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            
            const clientesComDebito = clientes.filter(cliente => {
                const debito = calcularDebitoCliente(cliente.id);
                return debito > 0;
            });
            
            if (clientesComDebito.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>Nenhum d√©bito pendente!</p></div>';
            } else {
                clientesComDebito.forEach(cliente => {
                    const vendasCliente = vendas.filter(v => v.clienteId === cliente.id && v.status === 'pendente');
                    const debito = vendasCliente.reduce((total, venda) => total + venda.total, 0);
                    
                    totalGeral += debito;
                    totalDevedores++;
                    
                    // Verificar se tem venda vencida hoje
                    vendasCliente.forEach(venda => {
                        const dataVenc = new Date(venda.dataPagamento);
                        dataVenc.setHours(0, 0, 0, 0);
                        if (dataVenc <= hoje) {
                            totalVencidoHoje += venda.total;
                        }
                    });
                    
                    const proximaData = vendasCliente.length > 0 ? 
                        new Date(Math.min(...vendasCliente.map(v => new Date(v.dataPagamento)))) : null;
                    
                    const clienteDiv = document.createElement('div');
                    clienteDiv.className = 'card';
                    clienteDiv.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h3>${cliente.nome}</h3>
                                <p>üì± ${cliente.telefone}</p>
                                <p>üìÖ Pr√≥ximo vencimento: ${proximaData ? formatarData(proximaData) : 'N/A'}</p>
                                <p>${vendasCliente.length} venda(s) pendente(s)</p>
                            </div>
                            <div style="text-align: right;">
                                <p class="debt-amount">R$ ${debito.toFixed(2).replace('.', ',')}</p>
                                <div style="margin-top: 10px; display: flex; gap: 10px;">
                                    <button onclick="verDetalhesDebito('${cliente.id}')">Detalhes</button>
                                    <button class="btn-success" onclick="registrarPagamento('${cliente.id}', ${debito})">Pagar</button>
                                </div>
                            </div>
                        </div>
                    `;
                    container.appendChild(clienteDiv);
                });
            }
            
            // Atualizar estat√≠sticas
            document.getElementById('totalAberto').textContent = totalGeral.toFixed(2).replace('.', ',');
            document.getElementById('totalDevedores').textContent = totalDevedores;
            document.getElementById('vencidosHoje').textContent = totalVencidoHoje.toFixed(2).replace('.', ',');
        }

        function filtrarDebitos() {
            const busca = document.getElementById('buscarDebito').value.toLowerCase();
            const cards = document.querySelectorAll('#listaDebitos .card');
            
            cards.forEach(card => {
                const nome = card.querySelector('h3').textContent.toLowerCase();
                card.style.display = nome.includes(busca) ? 'block' : 'none';
            });
        }

        function verDetalhesCliente(clienteId) {
            const cliente = clientes.find(c => c.id === clienteId);
            const vendasCliente = vendas.filter(v => v.clienteId === clienteId);
            
            document.getElementById('modalClienteNome').textContent = cliente.nome;
            
            let html = `
                <p><strong>Telefone:</strong> ${cliente.telefone}</p>
                <p><strong>Dia de Pagamento:</strong> ${cliente.diaPagamento}</p>
                <p><strong>Status:</strong> ${cliente.autorizado ? 'Autorizado' : 'N√£o autorizado'}</p>
                <hr>
                <h3>Hist√≥rico de Compras</h3>
            `;
            
            if (vendasCliente.length === 0) {
                html += '<p>Nenhuma compra registrada.</p>';
            } else {
                html += '<div class="transaction-list">';
                vendasCliente.forEach(venda => {
                    html += `
                        <div class="transaction-item">
                            <p><strong>${formatarData(new Date(venda.data))}</strong></p>
                            <p>Total: R$ ${venda.total.toFixed(2).replace('.', ',')}</p>
                            <p>Status: ${venda.status === 'pendente' ? '‚è≥ Pendente' : '‚úÖ Pago'}</p>
                            ${venda.observacoes ? `<p>Obs: ${venda.observacoes}</p>` : ''}
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            document.getElementById('modalClienteConteudo').innerHTML = html;
            document.getElementById('modalCliente').style.display = 'block';
        }

        function verDetalhesDebito(clienteId) {
            const cliente = clientes.find(c => c.id === clienteId);
            const vendasPendentes = vendas.filter(v => v.clienteId === clienteId && v.status === 'pendente');
            
            document.getElementById('modalClienteNome').textContent = `D√©bitos - ${cliente.nome}`;
            
            let html = '<div class="transaction-list">';
            let total = 0;
            
            vendasPendentes.forEach(venda => {
                total += venda.total;
                html += `
                    <div class="card">
                        <p><strong>Data:</strong> ${formatarData(new Date(venda.data))}</p>
                        <p><strong>Vencimento:</strong> ${formatarData(new Date(venda.dataPagamento))}</p>
                        <p><strong>Total:</strong> R$ ${venda.total.toFixed(2).replace('.', ',')}</p>
                        ${venda.observacoes ? `<p><strong>Obs:</strong> ${venda.observacoes}</p>` : ''}
                        <h4>Itens:</h4>
                        <ul>
                `;
                
                venda.itens.forEach(item => {
                    html += `<li>${item.descricao || 'Item'} - R$ ${item.valor.toFixed(2).replace('.', ',')}</li>`;
                });
                
                html += `
                        </ul>
                        <button class="btn-success" onclick="pagarVenda('${venda.id}')" style="margin-top: 10px;">
                            Pagar esta venda
                        </button>
                    </div>
                `;
            });
            
            html += '</div>';
            html += `<div class="summary-box" style="margin-top: 20px;">
                        <h2>Total Geral: R$ ${total.toFixed(2).replace('.', ',')}</h2>
                        <button onclick="registrarPagamento('${clienteId}', ${total})" style="margin-top: 10px;">
                            Pagar Tudo
                        </button>
                     </div>`;
            
            document.getElementById('modalClienteConteudo').innerHTML = html;
            document.getElementById('modalCliente').style.display = 'block';
        }

        function pagarVenda(vendaId) {
            if (confirm('Confirmar pagamento desta venda?')) {
                const venda = vendas.find(v => v.id === vendaId);
                venda.status = 'pago';
                venda.dataPagamentoReal = new Date().toISOString();
                
                pagamentos.push({
                    id: Date.now().toString(),
                    vendaId: vendaId,
                    clienteId: venda.clienteId,
                    valor: venda.total,
                    data: new Date().toISOString()
                });
                
                salvarDados();
                fecharModal();
                atualizarDebitos();
                atualizarRelatorios();
                
                // Mostrar mensagem de sucesso
                const successMsg = document.createElement('div');
                successMsg.className = 'success-message';
                successMsg.textContent = 'Pagamento registrado com sucesso!';
                document.querySelector('.content').insertBefore(successMsg, document.querySelector('.content').firstChild);
                
                setTimeout(() => successMsg.remove(), 3000);
            }
        }

        function registrarPagamento(clienteId, valor) {
            if (confirm(`Confirmar pagamento de R$ ${valor.toFixed(2).replace('.', ',')}?`)) {
                const vendasCliente = vendas.filter(v => v.clienteId === clienteId && v.status === 'pendente');
                
                vendasCliente.forEach(venda => {
                    venda.status = 'pago';
                    venda.dataPagamentoReal = new Date().toISOString();
                    
                    pagamentos.push({
                        id: Date.now().toString() + Math.random(),
                        vendaId: venda.id,
                        clienteId: clienteId,
                        valor: venda.total,
                        data: new Date().toISOString()
                    });
                });
                
                salvarDados();
                fecharModal();
                atualizarDebitos();
                atualizarRelatorios();
                atualizarListaClientes();
                
                // Mostrar mensagem de sucesso
                const successMsg = document.createElement('div');
                successMsg.className = 'success-message';
                successMsg.textContent = 'Pagamento total registrado com sucesso!';
                document.querySelector('.content').insertBefore(successMsg, document.querySelector('.content').firstChild);
                
                setTimeout(() => successMsg.remove(), 3000);
            }
        }

        // Fun√ß√µes de Relat√≥rio
        function atualizarRelatorios() {
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            
            const mesAtual = new Date();
            mesAtual.setDate(1);
            mesAtual.setHours(0, 0, 0, 0);
            
            // Vendas de hoje
            const vendasHoje = vendas.filter(v => {
                const dataVenda = new Date(v.data);
                dataVenda.setHours(0, 0, 0, 0);
                return dataVenda.getTime() === hoje.getTime();
            });
            
            // Vendas do m√™s
            const vendasMes = vendas.filter(v => {
                const dataVenda = new Date(v.data);
                return dataVenda >= mesAtual;
            });
            
            // Pagamentos de hoje
            const pagamentosHoje = pagamentos.filter(p => {
                const dataPag = new Date(p.data);
                dataPag.setHours(0, 0, 0, 0);
                return dataPag.getTime() === hoje.getTime();
            });
            
            const totalVendasHoje = vendasHoje.reduce((total, v) => total + v.total, 0);
            const totalVendasMes = vendasMes.reduce((total, v) => total + v.total, 0);
            const totalRecebidoHoje = pagamentosHoje.reduce((total, p) => total + p.valor, 0);
            
            document.getElementById('vendasHoje').textContent = totalVendasHoje.toFixed(2).replace('.', ',');
            document.getElementById('vendasMes').textContent = totalVendasMes.toFixed(2).replace('.', ',');
            document.getElementById('recebidoHoje').textContent = totalRecebidoHoje.toFixed(2).replace('.', ',');
            
            // Hist√≥rico de transa√ß√µes
            const todasTransacoes = [
                ...vendas.map(v => ({...v, tipo: 'venda'})),
                ...pagamentos.map(p => ({...p, tipo: 'pagamento'}))
            ].sort((a, b) => new Date(b.data) - new Date(a.data)).slice(0, 20);
            
            const container = document.getElementById('historicoTransacoes');
            container.innerHTML = '';
            
            if (todasTransacoes.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>Nenhuma transa√ß√£o registrada.</p></div>';
            } else {
                todasTransacoes.forEach(trans => {
                    const div = document.createElement('div');
                    div.className = 'transaction-item';
                    
                    if (trans.tipo === 'venda') {
                        const cliente = clientes.find(c => c.id === trans.clienteId);
                        div.innerHTML = `
                            <p><strong>üìù Venda</strong> - ${formatarDataHora(new Date(trans.data))}</p>
                            <p>Cliente: ${cliente ? cliente.nome : 'Desconhecido'}</p>
                            <p>Valor: R$ ${trans.total.toFixed(2).replace('.', ',')}</p>
                        `;
                    } else {
                        const cliente = clientes.find(c => c.id === trans.clienteId);
                        div.innerHTML = `
                            <p><strong>üí∞ Pagamento</strong> - ${formatarDataHora(new Date(trans.data))}</p>
                            <p>Cliente: ${cliente ? cliente.nome : 'Desconhecido'}</p>
                            <p>Valor: R$ ${trans.valor.toFixed(2).replace('.', ',')}</p>
                        `;
                    }
                    
                    container.appendChild(div);
                });
            }
        }

        // Fun√ß√µes auxiliares
        function formatarData(data) {
            return data.toLocaleDateString('pt-BR');
        }

        function formatarDataHora(data) {
            return data.toLocaleString('pt-BR');
        }

        function fecharModal() {
            document.getElementById('modalCliente').style.display = 'none';
        }

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modal = document.getElementById('modalCliente');
            if (event.target === modal) {
                fecharModal();
            }
        }

        // Formata√ß√£o autom√°tica do telefone
        document.getElementById('telefoneCliente').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);
            
            if (value.length > 6) {
                value = `(${value.slice(0, 2)}) ${value.slice(2, 7)}-${value.slice(7)}`;
            } else if (value.length > 2) {
                value = `(${value.slice(0, 2)}) ${value.slice(2)}`;
            } else if (value.length > 0) {
                value = `(${value}`;
            }
            
            e.target.value = value;
        });

        // Sistema de Autocomplete
        function setupAutocomplete() {
            const obsInput = document.getElementById('obsCompra');
            const suggestions = document.getElementById('autocompleteSuggestions');
            let currentFocus = -1;
            
            obsInput.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                const lastComma = value.lastIndexOf(',');
                const currentTerm = value.substring(lastComma + 1).trim();
                
                if (currentTerm.length < 2) {
                    suggestions.classList.remove('active');
                    return;
                }
                
                const matches = produtos.filter(p => 
                    p.nome.toLowerCase().includes(currentTerm) &&
                    !selectedProducts.includes(p.nome)
                ).slice(0, 10);
                
                suggestions.innerHTML = '';
                currentFocus = -1;
                
                // Se n√£o houver correspond√™ncias exatas, mostrar op√ß√£o de adicionar
                if (currentTerm.length >= 2) {
                    // Verificar se j√° existe um produto com esse nome exato
                    const existeExato = produtos.some(p => 
                        p.nome.toLowerCase() === currentTerm.toLowerCase()
                    );
                    
                    if (!existeExato && currentTerm.length > 0) {
                        const addDiv = document.createElement('div');
                        addDiv.className = 'add-new-product';
                        addDiv.innerHTML = `
                            <strong>+ Adicionar "${currentTerm}"</strong> como novo produto
                        `;
                        
                        addDiv.addEventListener('click', function() {
                            adicionarNovoProduto(currentTerm);
                        });
                        
                        suggestions.appendChild(addDiv);
                    }
                }
                
                matches.forEach((produto, index) => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    div.innerHTML = `
                        <strong>${produto.nome}</strong>
                        <span class="suggestion-category">${produto.categoria}</span>
                    `;
                    
                    div.addEventListener('click', function() {
                        selectProduct(produto.nome);
                    });
                    
                    suggestions.appendChild(div);
                });
                
                if (suggestions.innerHTML !== '') {
                    suggestions.classList.add('active');
                } else {
                    suggestions.classList.remove('active');
                }
            });
            
            obsInput.addEventListener('keydown', function(e) {
                const items = suggestions.querySelectorAll('.suggestion-item, .add-new-product');
                
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    currentFocus++;
                    addActive(items);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    currentFocus--;
                    addActive(items);
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (currentFocus > -1 && items[currentFocus]) {
                        items[currentFocus].click();
                    } else if (e.key === 'Enter' && this.value.trim()) {
                        // Se pressionar Enter sem selecionar nada, adiciona o texto como item
                        const value = this.value;
                        const lastComma = value.lastIndexOf(',');
                        const currentTerm = value.substring(lastComma + 1).trim();
                        
                        if (currentTerm.length > 0) {
                            selectProduct(currentTerm);
                        }
                    }
                }
            });
            
            function addActive(items) {
                if (!items) return false;
                removeActive(items);
                if (currentFocus >= items.length) currentFocus = 0;
                if (currentFocus < 0) currentFocus = items.length - 1;
                items[currentFocus].classList.add('selected');
            }
            
            function removeActive(items) {
                for (let i = 0; i < items.length; i++) {
                    items[i].classList.remove('selected');
                }
            }
            
            document.addEventListener('click', function(e) {
                if (!obsInput.contains(e.target) && !suggestions.contains(e.target)) {
                    suggestions.classList.remove('active');
                }
            });
        }
        
        function selectProduct(productName) {
            selectedProducts.push(productName);
            updateSelectedItems();
            document.getElementById('obsCompra').value = '';
            document.getElementById('autocompleteSuggestions').classList.remove('active');
        }
        
        function removeSelectedProduct(productName) {
            selectedProducts = selectedProducts.filter(p => p !== productName);
            updateSelectedItems();
        }
        
        function updateSelectedItems() {
            const container = document.getElementById('selectedItems');
            container.innerHTML = '';
            
            selectedProducts.forEach(product => {
                const div = document.createElement('div');
                div.className = 'selected-item';
                div.innerHTML = `
                    ${product}
                    <button onclick="removeSelectedProduct('${product}')">√ó</button>
                `;
                container.appendChild(div);
            });
        }
        
        function adicionarNovoProduto(nome) {
            // Capitalizar primeira letra
            const nomeFormatado = nome.charAt(0).toUpperCase() + nome.slice(1).toLowerCase();
            
            // Adicionar √† lista de produtos
            produtos.push({
                nome: nomeFormatado,
                categoria: 'Outros'
            });
            
            // Salvar no localStorage
            salvarDados();
            
            // Selecionar o produto
            selectProduct(nomeFormatado);
        }
    </script>

  <script>
    const users = {
        "hudson": "c056e417197097de3f4cc88681eed4ba315911867b10e3124af01da334afffaf",
        "brenno": "d24ec2a7ab452e93d819f2fda42835428d7ddc3485a1aeece8589935ff87a8ae"
    };

    async function login() {
        const username = document.getElementById('username').value.trim().toLowerCase();
        const password = document.getElementById('password').value;

        if (!users[username]) {
            document.getElementById('loginError').style.display = 'block';
            return;
        }

        const encoder = new TextEncoder();
        const data = encoder.encode(password);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        
        if (users[username] === hashHex) {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('logoutButtonContainer').style.display = 'block';
            document.querySelector('.container').style.filter = 'none';
        } else {
            document.getElementById('loginError').style.display = 'block';
        }
    }

    function logout() {
        document.getElementById('loginContainer').style.display = 'flex';
        document.getElementById('logoutButtonContainer').style.display = 'none';
        document.querySelector('.container').style.filter = 'blur(4px)';
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
        document.getElementById('loginError').style.display = 'none';
    }

    function togglePasswordVisibility() {
        const pwInput = document.getElementById('password');
        pwInput.type = pwInput.type === "password" ? "text" : "password";
    }

    window.addEventListener('load', () => {
        document.querySelector('.container').style.filter = 'blur(4px)';
    });
  </script>



</body>
</html>